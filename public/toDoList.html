<!DOCTYPE html>
<html lang="en">

<head>
    <title>To Do List Terminal Logistics</title>
</head>

<body>
    <style>
        body {
            background-color: rgb(0, 13, 100);
            color: white;
            font-family: Arial, sans-serif;
        }

        .add,
        .update {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
        }

        .pendiente,
        .enProgreso,
        .completada,
        h2 {
            border: 0px;
            padding: 10px;
            margin-bottom: 20px;
            width: 400px;
        }

        .apartados {
            border: 1px solid white;
            padding: 10px;
            border-radius: 10px;
        }

        .tableTasks {
            display: flex;
            gap: 20px;
        }

        button {
            background-color: rgb(255, 213, 0);
            border: none;
            padding: 10px;
            border-radius: 5px;
            color: rgb(0, 26, 255);
        }

        input,
        select {
            padding: 5px;
            border-radius: 5px;
        }
    </style>
    <div class="add">
        <p>Agrega una tarea</p>
        <input type="text" id="title" placeholder="Titulo">
        <input type="text" id="description" placeholder="Descripción">
        <select id="status">
            <option value="0">Pendiente</option>
            <option value="1">En progreso</option>
            <option value="2">Completada</option>
        </select>
        <button id="addElement">Agregar</button>
    </div>
    <div class="update" style="display:none;" id="updateDiv">
        <p>Actualiza tu tarea</p>
        <input type="text" id="titleU" placeholder="Titulo">
        <input type="text" id="descriptionU" placeholder="Descripción">
        <select id="statusU">
            <option value="0">Pendiente</option>
            <option value="1">En progreso</option>
            <option value="2">Completada</option>
        </select>
        <button id="updateElement">Actualizar</button>
    </div>
    <div class="tableTasks">
        <div class="apartados">
            <h2>Pendiente</h2>
            <div id="pendiente"></div>
        </div>
        <div class="apartados">
            <h2>En progreso</h2>
            <div id="enProgreso"></div>
        </div>
        <div class="apartados">
            <h2>Completado</h2>
            <div id="completada"></div>
        </div>
    </div>
    <script>
        window.onload = refresh;
        let tasks = [];
        let idForUpdate = null;
        const divUpdate = document.getElementById("updateDiv");

        function refresh() {
            document.getElementById("pendiente").innerHTML = "";
            document.getElementById("enProgreso").innerHTML = "";
            document.getElementById("completada").innerHTML = "";

            fetch("/tasks").then(response => response.json()).then(data => {
                data.items.forEach(task => {
                    tasks = data.items;
                    let taskDiv = document.createElement("div");
                    taskDiv.innerHTML = `<div style="background-color: rgb(255, 255, 255,0.4); border-radius: 10px; padding: 10px; margin-bottom: 20px; width: 400px; color: black"><h3>${task.title}</h3><p>${task.description}</p><div style="margin-bottom: 15px;"><button onclick="fetch('/tasks/${task.id}', { method: 'DELETE' }).then(() => refresh())">Eliminar</button>
                        <button onclick="handleUpdateTask(${task.id})">Actualizar</button></div></div>`;

                    if (task.status === 0) {
                        document.getElementById("pendiente").appendChild(taskDiv);
                    } else if (task.status === 1) {
                        document.getElementById("enProgreso").appendChild(taskDiv);
                    } else if (task.status === 2) {
                        document.getElementById("completada").appendChild(taskDiv);
                    }
                });
            });
        }

        const btnAdd = document.getElementById("addElement");
        const btnUpdate = document.getElementById("updateElement");

        btnAdd.addEventListener('click', handleAddTask);
        btnUpdate.addEventListener('click', handleUpdateFullTask);

        function handleAddTask() {
            let title = document.getElementById("title").value;
            let description = document.getElementById("description").value;
            let status = parseInt(document.getElementById("status").value);

            if (title !== "" && description !== "") {
                fetch("/tasks", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ title, description, status }),
                }).then(data => {
                    document.getElementById("title").value = "";
                    document.getElementById("description").value = "";
                    document.getElementById("status").value = 0;
                    refresh();
                })
            }
        }

        function handleUpdateFullTask() {
            let title = document.getElementById("titleU").value;
            let description = document.getElementById("descriptionU").value;
            let status = parseInt(document.getElementById("statusU").value);

            fetch(`/tasks/${idForUpdate}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ title, description, status }),
            }).then(data => {
                document.getElementById("titleU").value = "";
                document.getElementById("descriptionU").value = "";
                document.getElementById("statusU").value = 0;
                refresh();
            })
            divUpdate.style.display = "none";
        }

        function handleUpdateTask(id) {
            divUpdate.style.display = "block";
            idForUpdate = id;

            const task = tasks.find(task => task.id === id);
            if (task) {
                document.getElementById("titleU").value = task.title;
                document.getElementById("descriptionU").value = task.description;
                document.getElementById("statusU").value = task.status;
            } else {
                document.getElementById("titleU").value = "";
                document.getElementById("descriptionU").value = "";
                document.getElementById("statusU").value = 0;
            }
        }
    </script>
</body>

</html>